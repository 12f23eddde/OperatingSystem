##### 1. 某虚拟文件系统空间的最大容量为4TB，磁盘块（基本分配单位）大小为1KB。文件控制块（FCB）包含一个512B主索引表。请回答下列问题。 

###### 1.1 假设主索引表只采用直接索引结构，主索引表中保存文件占用的磁盘块号。主索引表表项最少要占多少字节？可支持的单个文件最大长度是多少字节？

一个文件系统空间内最多存在$2^{42}/2^{10}=2^{32}$个块，也就是索引表表项至少需要32bit，也就是4B。一个索引表内最多能包含$512/4=128$个表项，也就是一个文件的大小最大为$128*1$KB$=128$KB。

###### 1.2 假设主索引表采用如下结构：第0～7字节采用<起始块号， 块数>的格式，表示文件创建时连续分配给文件的磁盘空间。其中起始块号占6B、块数占2B，剩余504B采用直接索引结构，一个索引项占6B。试问，采用这种结构可支持的单个文件的最大长度是多少字节？为了使单个文件的长度达到最大，起始块号和块数分别所占的合理字节数是多少？请说明理由。

连续分配的空间最大为$2^{16}=65536$个块，直接索引结构最多包含$504/6=84$个索引表表项，对应84个块，即文件最大长度为65620KB。

为了使单个文件的长度达到最大，我们需要给文件连续分配尽量多的块。由于文件系统空间内最多存在$2^{32}$个块，因此只要块数长度$\geq $ 4B，就可以达到整个文件系统空间的大小4TB。

##### 2. 假设某文件系统是一级目录结构，文件的数据一次性写入磁盘， 已写入的文件不可修改，但可多次创建新文件。 请回答如下问题： 

###### 2.1 在顺序、链接、索引三种文件的物理结构方式中，哪一种更合适？请说明理由。为定位文件的数据块，需要在FCB中设计哪些相关描述字段？

顺序最合适。这个文件系统只允许一次性写入磁盘，因此不存在对文件进行插入和删除造成的碎片问题。顺序的组织方式在尽可能减少查找文件块的开销的同时，也有最短的访问时间。（受磁盘的物理结构影响，顺序读写性能远远超过随机读写）

为了定位文件的数据块，我们需要在FCB中加上文件的起始块号和块数。

###### 2.2 为快速找到文件，是集中存储FCB好，还是与对应的文件数据块一起存储好？请说明理由。

集中存储FCB好。为了快速找到文件，我们需要尽快从磁盘中读出文件的FCB。集中存储FCB将访问FCB的过程从随机I/O变为顺序I/O，从而提升了文件查找的性能。